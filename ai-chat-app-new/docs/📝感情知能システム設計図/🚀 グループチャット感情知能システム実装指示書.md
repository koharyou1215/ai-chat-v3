🚀 グループチャット感情知能システム実装指示書

  📋 実装指示の段階的手順

  🔥 Phase 1: 安全な基盤構築

  指示1-1: 完全バックアップとブランチ作成

  # Claude Codeに以下を指示：
  "プロジェクトの完全バックアップを作成し、新しい機能ブランチを作成してください。
  以下の手順で実行：

  1. 現在の状態を完全バックアップ
  2. feature/group-emotional-intelligence ブランチを作成
  3. 既存の全機能が正常動作することを確認"

  指示1-2: 基本型定義の追加

  # Claude Codeに以下を指示：
  "src/types/core/ に以下の新しい型定義ファイルを作成してください：

  1. group-emotional-intelligence.types.ts を作成
  2. 既存の group-chat.types.ts は一切変更せず、拡張型のみ定義
  3. 以下の型を実装：
     - EmotionalWeight
     - GroupEmotionalState
     - CharacterRelationshipMatrix
     - EmotionalContagionEffect

  既存のコードは一切変更しないでください。"

  指示1-3: 機能フラグシステム実装

  # Claude Codeに以下を指示：
  "settings.slice.ts に機能フラグシステムを追加してください：

  1. EmotionalIntelligenceFlags インターフェースを追加
  2. 全フラグはデフォルトで false に設定
  3. 既存の設定は一切変更しない
  4. updateEmotionalFlags メソッドを追加

  実装後、既存の全機能が正常動作することを確認してください。"

  🧠 Phase 2: 感情分析エンジン統合

  指示2-1: 感情分析サービス作成

  # Claude Codeに以下を指示：
  "src/services/emotion/ ディレクトリを作成し、以下のファイルを実装してください：

  1. EmotionAnalyzer.ts - 基本感情分析エンジン
  2. GroupEmotionAnalyzer.ts - グループ専用感情分析
  3. EmotionalContagionEngine.ts - 感情伝播システム

  重要な制約：
  - 既存のAPI呼び出しは一切変更しない
  - バックグラウンド実行のみ（UIをブロックしない）
  - エラー発生時は既存機能に影響しない"

  指示2-2: GroupChatSlice の安全な拡張

  # Claude Codeに以下を指示：
  "groupChat.slice.ts を以下の方針で拡張してください：

  1. 既存のインターフェースとメソッドは一切変更しない
  2. 新しいオプショナルプロパティのみ追加：
     - emotional_intelligence?: GroupEmotionalIntelligence
  3. 新しいメソッドのみ追加：
     - analyzeGroupEmotion (オプショナル)
     - updateEmotionalState (オプショナル)

  実装後、既存のグループチャット機能がすべて正常動作することを確認してください。"

  ⚡ Phase 3: UI統合と効果システム

  指示3-1: MessageBubble コンポーネント拡張

  # Claude Codeに以下を指示：
  "MessageBubble.tsx を以下の方針で拡張してください：

  1. 既存のMessageBubbleの機能は完全保持
  2. グループモード時のみ感情効果を追加
  3. 機能フラグで効果のon/off制御
  4. パフォーマンス影響ゼロを保証

  実装手順：
  1. 既存コードのバックアップ
  2. 感情効果コンポーネントを条件付きで追加
  3. 既存の表示・動作が変わらないことを確認"

  指示3-2: グループ感情効果コンポーネント作成

  # Claude Codeに以下を指示：
  "src/components/emotion/ ディレクトリに以下を作成してください：

  1. GroupEmotionalEffects.tsx - グループ感情効果
  2. EmotionalResonanceDisplay.tsx - 感情共鳴表示
  3. RelationshipVisualization.tsx - 関係性可視化

  制約：
  - 既存UIに影響を与えない
  - 機能フラグで制御可能
  - エラー時は非表示（既存機能に影響なし）"

  🎯 Phase 4: 高度機能統合

  指示4-1: シナリオシステムとの統合

  # Claude Codeに以下を指示：
  "既存のシナリオシステムと感情システムを統合してください：

  1. ScenarioSetupModal.tsx に感情要素の設定項目を追加
  2. 既存のシナリオ機能は完全保持
  3. 感情的目標の設定をオプション機能として追加
  4. シナリオなしでも従来通り動作することを確認

  重要：既存のシナリオ作成・実行機能は一切変更しない"

  指示4-2: 最終統合テスト

  # Claude Codeに以下を指示：
  "全システムの統合テストを実行してください：

  1. 既存機能テスト：
     - 個人チャット正常動作確認
     - グループチャット正常動作確認
     - キャラクター切り替え動作確認
     - 設定保存・読み込み確認

  2. 新機能テスト：
     - 感情分析機能テスト
     - グループ感情効果テスト
     - 機能フラグ動作テスト

  3. エラー処理テスト：
     - 新機能エラー時の既存機能保護確認"

  ---
  🎯 実装指示の具体例

  例1: 段階1実装開始

  指示: "グループチャット感情知能システムの基盤を構築してください。

  要件:
  1. 既存のグループチャット機能は一切変更しない
  2. src/types/core/group-emotional-intelligence.types.ts を作成
  3. 基本的な感情分析型定義を実装
  4. 機能フラグをsettings.slice.tsに追加（全てfalse）

  完了基準:
  - 既存機能100%動作維持
  - 新しい型定義ファイル作成完了
  - TypeScript エラーゼロ
  - ビルド成功"

  例2: 感情分析エンジン実装

  指示: "グループチャット専用の感情分析エンジンを実装してください。

  要件:
  1. src/services/emotion/GroupEmotionAnalyzer.ts を作成
  2. 既存のsendGroupMessage関数は変更せず、分析はバックグラウンド実行
  3. エラー発生時は既存機能に影響しない
  4. 分析結果はオプショナルなストア領域に保存

  技術制約:
  - UIをブロックしない（setTimeout使用）
  - Promise.allSettled でエラー耐性確保
  - 既存APIManager の変更禁止

  テスト項目:
  - グループメッセージ送信が正常動作
  - バックグラウンド分析が実行される
  - 分析エラー時もチャット継続"

  例3: UI効果統合

  指示: "グループチャットに感情効果を追加してください。

  実装箇所:
  1. MessageBubble.tsx の条件付き拡張
  2. 新規: EmotionalResonanceEffects.tsx コンポーネント
  3. 機能フラグによる表示制御

  実装方針:
  - 既存MessageBubbleの表示・動作は完全保持
  - グループモード＋機能フラグ有効時のみ効果表示
  - パフォーマンス影響最小化

  検証項目:
  - 個人チャット：変更なし
  - グループチャット（フラグOFF）：変更なし
  - グループチャット（フラグON）：効果表示"

  ---
  ✅ 実装成功の確認方法

  各段階での確認指示

  指示: "実装が完了したら以下を確認してください：

  1. 機能確認:
     - npm run dev でエラーなく起動
     - 既存の個人チャットが正常動作
     - 既存のグループチャットが正常動作
     - 新機能が期待通り動作（フラグON時のみ）

  2. 品質確認:
     - TypeScript エラーがない
     - コンソールエラーがない
     - 設定保存・読み込みが正常
     - パフォーマンス低下なし

  3. 安全性確認:
     - 新機能無効化で完全に従来通り動作
     - エラー発生時の既存機能保護
     - データ互換性維持"

  ---
  🚨 重要な実装ルール

  Claude Code への明確な指示:

  "実装時は以下を絶対に守ってください：

  ❌ 絶対禁止:
  - 既存のGroupChatSlice メソッドの変更
  - 既存のMessageBubble 表示ロジック変更
  - 既存のAPI呼び出し方法変更
  - 設定の自動変更・デフォルト値変更

  ✅ 必須実施:
  - 新機能は全てオプショナル実装
  - エラー時の既存機能保護
  - 機能フラグによる制御
  - 段階的実装・テスト・確認

  ⚡ パフォーマンス:
  - UIをブロックする処理禁止
  - バックグラウンド実行必須
  - キャッシュ・最適化実装"