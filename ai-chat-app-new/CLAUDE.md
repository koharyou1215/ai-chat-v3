# Claude Code 開発設定

## 必須参照ドキュメント

### 🎯 AI Chat V3 完全開発ガイド
- **ファイルパス**: `🎯 AI Chat V3 完全開発ガイド.md`
- **ルール**: 
  - 開発作業開始時に必ずこのドキュメントを読み込む
  - 機能追加・修正後は該当セクションを更新する
  - アーキテクチャ変更時は関連する図表も更新する

## 厳重注意
- **型システム優先**: `any`型絶対禁止
- **Gemini API**: 対応モデルは gemini-2.5-flash, gemini-2.5-flash-light, gemini-2.5-pro のみ

### 🚨 型安全開発フロー（必須遵守）
1. 型定義更新 → 2. 型検証（`npx tsc --noEmit`） → 3. 実装 → 4. ビルド確認

### 基本開発フロー
1. 完全開発ガイドを参照 → 2. 実装 → 3. ドキュメント更新

## 🚨 Gemini API ルール（絶対遵守）
- **対応モデル**: gemini-2.5-flash, gemini-2.5-flash-light, gemini-2.5-pro のみ
- **フォールバック禁止**: APIエラー時の自動フォールバック機能は実装しない
- **モデル名自動変換禁止**: モデル名の自動変換・自動修正は行わない
- **デフォルトプロバイダー**: openrouterを基本デフォルトとする

## プロジェクト保護ルール（絶対遵守）
- **既存UI・機能の保護**: アイコン、レイアウト、機能のUI要素は変更・削除しない
- **API互換性維持**: 既存のAPIインターフェース、データ構造を保持
- **設定永続化保護**: 設定の自動変更禁止、永続化動作を必ず検証

## デプロイ前必須チェック
- 根本原因の特定、既存機能の動作確認、設定永続化テスト
- ファイルアップロード、UI/UX、モバイル最適化の確認

## 開発サーバー運用ルール
- **ポート3000固定**: サーバーは必ずポート3000で起動
- **サーバー停止に注意**: 再起動に時間を要するため、Hot Reload優先で対応
- **デバッグツール制約**: ブラウザ開発者ツール使用不可
- **サーバー操作**: 詳細は TROUBLESHOOTING.md 参照

## 🔒 永続化保護ルール
- **LocalStorage保護**: 消去・リセット処理の追加禁止
- **必須永続化項目**: チャット履歴(sessions)、記憶システム、API設定、UI設定
- **機能保護**: 再生成ボタン等の既存機能削除・無効化禁止

## Character型とPersona型の保護
- **型定義準拠**: `Character,User Persona Type Definitive Format.md`に完全準拠
- **重要フィールド**: avatar_url（アイコン）、background_url（背景）、nsfw_profile（Character型のみ）
- **型定義変更時**: 全関連ファイルに反映必須

## トラブルシューティング
詳細は TROUBLESHOOTING.md 参照