<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰è¨ºæ–­</title>
  <style>
    body {
      font-family: monospace;
      background: #0f0f23;
      color: #fff;
      padding: 20px;
      line-height: 1.6;
    }
    h1 { color: #8b5cf6; }
    h2 { color: #ec4899; margin-top: 30px; }
    .box {
      background: #1e1e2e;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      border: 2px solid #374151;
    }
    .success { border-color: #10b981; }
    .error { border-color: #ef4444; }
    .warning { border-color: #f59e0b; }
    pre {
      background: #0a0a15;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .status {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 5px;
      margin: 5px 0;
    }
    .status.on { background: #10b981; color: #000; }
    .status.off { background: #ef4444; color: #fff; }
    .status.unknown { background: #f59e0b; color: #000; }
    button {
      background: #8b5cf6;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 5px;
      font-size: 14px;
    }
    button:hover { background: #7c3aed; }
    .instruction {
      background: #1e3a5f;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #3b82f6;
    }
  </style>
</head>
<body>
  <h1>ğŸ” ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>

  <div class="instruction">
    <strong>ğŸ“ ä½¿ã„æ–¹:</strong><br>
    1. ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸã¾ã¾ã€åˆ¥ã‚¿ãƒ–ã§ãƒãƒ£ãƒƒãƒˆç”»é¢ã‚’é–‹ã<br>
    2. è¨­å®šç”»é¢ã§ã€Œ3æ®µéšãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–å¿œç­”ã‚’æœ‰åŠ¹åŒ–ã€ã‚’ON/OFFã™ã‚‹<br>
    3. ã“ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã£ã¦ã€ŒğŸ”„ å†ç¢ºèªã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
    4. è¨­å®šå€¤ãŒæ­£ã—ãåæ˜ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
  </div>

  <button onclick="checkSettings()">ğŸ”„ å†ç¢ºèª</button>
  <button onclick="forceEnable()">âœ… å¼·åˆ¶çš„ã«æœ‰åŠ¹åŒ–</button>
  <button onclick="forceDisable()">âŒ å¼·åˆ¶çš„ã«ç„¡åŠ¹åŒ–</button>
  <button onclick="clearAll()">ğŸ—‘ï¸ ã™ã¹ã¦ã‚¯ãƒªã‚¢</button>

  <div id="results"></div>

  <script>
    function checkSettings() {
      const output = document.getElementById('results');
      output.innerHTML = '';

      // ==============================================
      // 1. unified-settings ã®ç¢ºèª
      // ==============================================
      const h2_1 = document.createElement('h2');
      h2_1.textContent = '1ï¸âƒ£ unified-settings (è¨­å®šãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼)';
      output.appendChild(h2_1);

      const unifiedStr = localStorage.getItem('unified-settings');
      if (unifiedStr) {
        try {
          const unified = JSON.parse(unifiedStr);
          const progressiveMode = unified.chat?.progressiveMode;

          const box1 = document.createElement('div');
          box1.className = 'box ' + (progressiveMode?.enabled ? 'success' : 'error');

          const statusSpan = document.createElement('span');
          statusSpan.className = 'status ' + (progressiveMode?.enabled ? 'on' : 'off');
          statusSpan.textContent = progressiveMode?.enabled ? 'ON' : 'OFF';

          box1.innerHTML = '<strong>ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹: </strong>';
          box1.appendChild(statusSpan);

          const pre1 = document.createElement('pre');
          pre1.textContent = JSON.stringify(progressiveMode, null, 2);
          box1.appendChild(pre1);

          output.appendChild(box1);
        } catch (e) {
          const errorBox = document.createElement('div');
          errorBox.className = 'box error';
          errorBox.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + e.message;
          output.appendChild(errorBox);
        }
      } else {
        const warnBox = document.createElement('div');
        warnBox.className = 'box warning';
        warnBox.textContent = 'âš ï¸ unified-settings ãŒå­˜åœ¨ã—ã¾ã›ã‚“';
        output.appendChild(warnBox);
      }

      // ==============================================
      // 2. ai-chat-v3-storage ã®ç¢ºèª
      // ==============================================
      const h2_2 = document.createElement('h2');
      h2_2.textContent = '2ï¸âƒ£ ai-chat-v3-storage (Zustandã‚¹ãƒˆã‚¢)';
      output.appendChild(h2_2);

      const storeStr = localStorage.getItem('ai-chat-v3-storage');
      if (storeStr) {
        try {
          const store = JSON.parse(storeStr);
          const progressiveMode = store.state?.chat?.progressiveMode;

          const box2 = document.createElement('div');
          box2.className = 'box ' + (progressiveMode?.enabled ? 'success' : 'error');

          const statusSpan2 = document.createElement('span');
          statusSpan2.className = 'status ' + (progressiveMode?.enabled ? 'on' : 'off');
          statusSpan2.textContent = progressiveMode?.enabled ? 'ON' : 'OFF';

          box2.innerHTML = '<strong>ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹: </strong>';
          box2.appendChild(statusSpan2);

          const pre2 = document.createElement('pre');
          pre2.textContent = JSON.stringify(progressiveMode, null, 2);
          box2.appendChild(pre2);

          output.appendChild(box2);
        } catch (e) {
          const errorBox = document.createElement('div');
          errorBox.className = 'box error';
          errorBox.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + e.message;
          output.appendChild(errorBox);
        }
      } else {
        const warnBox = document.createElement('div');
        warnBox.className = 'box warning';
        warnBox.textContent = 'âš ï¸ ai-chat-v3-storage ãŒå­˜åœ¨ã—ã¾ã›ã‚“';
        output.appendChild(warnBox);
      }

      // ==============================================
      // 3. æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
      // ==============================================
      const h2_3 = document.createElement('h2');
      h2_3.textContent = '3ï¸âƒ£ æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯';
      output.appendChild(h2_3);

      if (unifiedStr && storeStr) {
        try {
          const unified = JSON.parse(unifiedStr);
          const store = JSON.parse(storeStr);

          const unifiedEnabled = unified.chat?.progressiveMode?.enabled;
          const storeEnabled = store.state?.chat?.progressiveMode?.enabled;

          const box3 = document.createElement('div');
          if (unifiedEnabled === storeEnabled) {
            box3.className = 'box success';
            box3.innerHTML = `
              <strong>âœ… æ•´åˆæ€§: OK</strong><br>
              ä¸¡æ–¹ã¨ã‚‚ <span class="status ${unifiedEnabled ? 'on' : 'off'}">${unifiedEnabled ? 'ON' : 'OFF'}</span>
            `;
          } else {
            box3.className = 'box error';
            box3.innerHTML = `
              <strong>âŒ æ•´åˆæ€§: NGï¼ˆä¸ä¸€è‡´ï¼‰</strong><br>
              unified-settings: <span class="status ${unifiedEnabled ? 'on' : 'off'}">${unifiedEnabled ? 'ON' : 'OFF'}</span><br>
              ai-chat-v3-storage: <span class="status ${storeEnabled ? 'on' : 'off'}">${storeEnabled ? 'ON' : 'OFF'}</span><br>
              <br>
              <strong style="color: #f59e0b;">âš ï¸ ã“ã‚ŒãŒåŸå› ã§ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ãŒå‹•ä½œã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</strong>
            `;
          }
          output.appendChild(box3);
        } catch (e) {
          const errorBox = document.createElement('div');
          errorBox.className = 'box error';
          errorBox.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + e.message;
          output.appendChild(errorBox);
        }
      }

      // ==============================================
      // 4. ãƒ‡ãƒãƒƒã‚°æƒ…å ±
      // ==============================================
      const h2_4 = document.createElement('h2');
      h2_4.textContent = '4ï¸âƒ£ ãƒ‡ãƒãƒƒã‚°æƒ…å ±';
      output.appendChild(h2_4);

      const debugBox = document.createElement('div');
      debugBox.className = 'box';
      debugBox.innerHTML = `
        <strong>localStorage keys:</strong><br>
        <pre>${Object.keys(localStorage).join('\n')}</pre>
      `;
      output.appendChild(debugBox);
    }

    function forceEnable() {
      try {
        // unified-settings ã‚’æ›´æ–°
        const unifiedStr = localStorage.getItem('unified-settings');
        if (unifiedStr) {
          const unified = JSON.parse(unifiedStr);
          if (!unified.chat) unified.chat = {};
          unified.chat.progressiveMode = {
            enabled: true,
            showIndicators: true,
            highlightChanges: true,
            glowIntensity: 'medium',
            stageDelays: { reflex: 0, context: 1000, intelligence: 2000 }
          };
          localStorage.setItem('unified-settings', JSON.stringify(unified));
        }

        // ai-chat-v3-storage ã‚’æ›´æ–°
        const storeStr = localStorage.getItem('ai-chat-v3-storage');
        if (storeStr) {
          const store = JSON.parse(storeStr);
          if (!store.state) store.state = {};
          if (!store.state.chat) store.state.chat = {};
          store.state.chat.progressiveMode = {
            enabled: true,
            showIndicators: true,
            highlightChanges: true,
            glowIntensity: 'medium',
            stageDelays: { reflex: 0, context: 1000, intelligence: 2000 }
          };
          localStorage.setItem('ai-chat-v3-storage', JSON.stringify(store));
        }

        alert('âœ… ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã‚’å¼·åˆ¶çš„ã«æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸã€‚\nãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
        checkSettings();
      } catch (e) {
        alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + e.message);
      }
    }

    function forceDisable() {
      try {
        // unified-settings ã‚’æ›´æ–°
        const unifiedStr = localStorage.getItem('unified-settings');
        if (unifiedStr) {
          const unified = JSON.parse(unifiedStr);
          if (unified.chat && unified.chat.progressiveMode) {
            unified.chat.progressiveMode.enabled = false;
          }
          localStorage.setItem('unified-settings', JSON.stringify(unified));
        }

        // ai-chat-v3-storage ã‚’æ›´æ–°
        const storeStr = localStorage.getItem('ai-chat-v3-storage');
        if (storeStr) {
          const store = JSON.parse(storeStr);
          if (store.state?.chat?.progressiveMode) {
            store.state.chat.progressiveMode.enabled = false;
          }
          localStorage.setItem('ai-chat-v3-storage', JSON.stringify(store));
        }

        alert('âœ… ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã‚’å¼·åˆ¶çš„ã«ç„¡åŠ¹åŒ–ã—ã¾ã—ãŸã€‚\nãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
        checkSettings();
      } catch (e) {
        alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + e.message);
      }
    }

    function clearAll() {
      if (confirm('âš ï¸ ã™ã¹ã¦ã®LocalStorageã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚\nãƒãƒ£ãƒƒãƒˆå±¥æ­´ã€è¨­å®šã€ãƒ¡ãƒ¢ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚\næœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
        localStorage.clear();
        alert('âœ… ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
        checkSettings();
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
    window.onload = checkSettings;
  </script>
</body>
</html>
