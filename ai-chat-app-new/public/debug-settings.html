<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¨­å®šãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #0f0f23;
      color: #fff;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #8b5cf6;
      border-bottom: 2px solid #8b5cf6;
      padding-bottom: 10px;
    }
    h2 {
      color: #ec4899;
      margin-top: 30px;
    }
    pre {
      background: #1e1e2e;
      border: 1px solid #374151;
      border-radius: 8px;
      padding: 15px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
    .success {
      background: #10b981;
      color: #000;
    }
    .error {
      background: #ef4444;
      color: #fff;
    }
    .warning {
      background: #f59e0b;
      color: #000;
    }
    button {
      background: #8b5cf6;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    button:hover {
      background: #7c3aed;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ AI Chat V3 - è¨­å®šãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸</h1>

  <div>
    <button onclick="checkSettings()">è¨­å®šã‚’ç¢ºèª</button>
    <button onclick="enableProgressiveMode()">ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–</button>
    <button onclick="clearAllSettings()">ã™ã¹ã¦ã®è¨­å®šã‚’ã‚¯ãƒªã‚¢</button>
  </div>

  <div id="output"></div>

  <script>
    function log(message, type = 'info') {
      const output = document.getElementById('output');
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.textContent = message;
      output.appendChild(div);
    }

    function logJson(title, data) {
      const output = document.getElementById('output');
      const h2 = document.createElement('h2');
      h2.textContent = title;
      output.appendChild(h2);

      const pre = document.createElement('pre');
      pre.textContent = JSON.stringify(data, null, 2);
      output.appendChild(pre);
    }

    function checkSettings() {
      document.getElementById('output').innerHTML = '';

      log('='.repeat(60), 'info');
      log('ğŸ” è¨­å®šçŠ¶æ…‹ã®ç¢ºèªé–‹å§‹', 'info');
      log('='.repeat(60), 'info');

      // 1. unified-settings ã®ç¢ºèª
      const unifiedSettings = localStorage.getItem('unified-settings');
      if (unifiedSettings) {
        try {
          const settings = JSON.parse(unifiedSettings);
          log('âœ… unified-settings è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ', 'success');
          logJson('ğŸ“‹ unified-settings ã®å†…å®¹', {
            'chat.progressiveMode': settings.chat?.progressiveMode,
            'chat.memoryLimits': settings.chat?.memoryLimits,
            'chat.responseFormat': settings.chat?.responseFormat,
          });

          if (settings.chat?.progressiveMode?.enabled === true) {
            log('âœ… ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã¯æœ‰åŠ¹ã§ã™ (unified-settings)', 'success');
          } else {
            log('âŒ ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã¯ç„¡åŠ¹ã§ã™ (unified-settings)', 'error');
          }
        } catch (e) {
          log('âŒ unified-settings ã®è§£æã«å¤±æ•—: ' + e.message, 'error');
        }
      } else {
        log('âŒ unified-settings ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
      }

      // 2. ai-chat-v3-storage ã®ç¢ºèª
      const zustandStore = localStorage.getItem('ai-chat-v3-storage');
      if (zustandStore) {
        try {
          const store = JSON.parse(zustandStore);
          log('âœ… ai-chat-v3-storage è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ', 'success');

          if (store.state?.chat) {
            logJson('ğŸ“‹ Zustand Store ã® chat è¨­å®š', {
              'chat.progressiveMode': store.state.chat.progressiveMode,
              'chat.memory_limits': store.state.chat.memory_limits,
            });

            if (store.state.chat.progressiveMode?.enabled === true) {
              log('âœ… ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã¯æœ‰åŠ¹ã§ã™ (Zustand)', 'success');
            } else {
              log('âŒ ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã¯ç„¡åŠ¹ã§ã™ (Zustand)', 'error');
            }
          } else {
            log('âš ï¸ Zustand Store ã« chat è¨­å®šãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
          }
        } catch (e) {
          log('âŒ ai-chat-v3-storage ã®è§£æã«å¤±æ•—: ' + e.message, 'error');
        }
      } else {
        log('âš ï¸ ai-chat-v3-storage ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (åˆå›èµ·å‹•ã®å¯èƒ½æ€§)', 'warning');
      }

      // 3. ã™ã¹ã¦ã®ã‚­ãƒ¼ã‚’è¡¨ç¤º
      log('='.repeat(60), 'info');
      log('ğŸ“¦ LocalStorage ã®å…¨ã‚­ãƒ¼:', 'info');
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        log(`  - ${key}`, 'info');
      }
    }

    function enableProgressiveMode() {
      try {
        // unified-settingsã‚’æ›´æ–°
        const unifiedSettings = localStorage.getItem('unified-settings');
        if (unifiedSettings) {
          const settings = JSON.parse(unifiedSettings);
          if (!settings.chat) {
            settings.chat = {};
          }
          settings.chat.progressiveMode = {
            enabled: true,
            showIndicators: true,
            highlightChanges: true,
            glowIntensity: 'medium',
            stageDelays: {
              reflex: 0,
              context: 1000,
              intelligence: 2000,
            },
          };
          localStorage.setItem('unified-settings', JSON.stringify(settings));
          log('âœ… ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸ (unified-settings)', 'success');
        }

        log('â„¹ï¸ ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„', 'warning');
      } catch (e) {
        log('âŒ è¨­å®šã®æ›´æ–°ã«å¤±æ•—: ' + e.message, 'error');
      }
    }

    function clearAllSettings() {
      if (confirm('ã™ã¹ã¦ã®è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
        localStorage.clear();
        log('âœ… ã™ã¹ã¦ã®è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
        log('â„¹ï¸ ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„', 'warning');
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
    window.onload = () => {
      checkSettings();
    };
  </script>
</body>
</html>
