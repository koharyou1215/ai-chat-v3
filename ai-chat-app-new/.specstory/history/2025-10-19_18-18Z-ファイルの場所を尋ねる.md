<!-- Generated by SpecStory -->

<!-- cursor Session 3539f08e-59cc-425f-bd92-43e439964f72 (2025-10-19 18:18Z) -->

# ファイルの場所を尋ねる (2025-10-19 18:18Z)

_**User (2025-10-19 18:18Z)**_

PROMPT_VERIFICATION_GUIDE.mdどこにあります？

---

_**Assistant (default)**_

`PROMPT_VERIFICATION_GUIDE.md`ファイルを探してみますね。


---

Tool use: **read_file**

Read file: PROMPT_VERIFICATION_GUIDE.md

---

`PROMPT_VERIFICATION_GUIDE.md`ファイルは、プロジェクトのルートディレクトリ（`C:\ai-chat-v3\ai-chat-app-new\`）にあります。

このファイルは、AI Chat V3プロジェクトのプロンプト検証ガイドとして、以下の内容を含んでいます：

## 📋 主な内容

1. **プロンプト生成システムの現状** - ソロチャットとグループチャットの実装差異
2. **Progressive Message System** - 3段階の段階的レスポンス生成システム
3. **ソロチャット プロンプト構造** - 統一8段階の構成
4. **グループチャット プロンプト構造** - 動的切替システム
5. **インスピレーション機能検証** - 返信提案システム
6. **実践的検証フロー** - 2分でできる確認手順
7. **実装ファイル一覧** - 2025年9月リファクタリング完了版

このガイドは、AI Chat V3プロジェクトの開発・デプロイメント時に、プロンプトシステムが正しく動作しているかを迅速に検証するためのものです。特に、キャラクターの一貫性、メモリーシステム、トラッカー機能、インスピレーション機能などの重要な要素の動作確認に役立ちます。

---

_**User (2025-10-19 18:18Z)**_

 プロンプト  
 何を投げているか  
 箇条書きで要約してもらえますか。

---

_**Assistant (default)**_

プロンプトシステムの概要を箇条書きで要約しますね。現在のシステムがどのようなプロンプトを投げているかを整理します。


---

Tool use: **read_file**

Read file: src/services/prompt-builder.service.ts

---

## 📋 プロンプトシステムの概要 - 何を投げているか

### 🎯 **基本構造（8段階構成）**

1. **AI/User定義** → `AI={{char}}, User={{user}}`
2. **システム指示** → `<system_instructions>...</system_instructions>`
3. **Jailbreak（有効時）** → `<jailbreak>...</jailbreak>`
4. **キャラクター情報** → `<character_information>...</character_information>`
5. **ペルソナ情報** → `<persona_information>...</persona_information>`
6. **関係状態** → `<relationship_state>...</relationship_state>`
7. **メモリー文脈** → `<memory_context>...</memory_context>`
8. **現在の入力** → `## Current Input\n{{user}}: [input]\n{{char}}:`

### 🧠 **詳細な内容**

#### **システム指示**
- カスタムシステムプロンプト（設定で有効な場合）
- デフォルトシステムプロンプト（フォールバック）
- キャラクター固有のシステムプロンプト

#### **キャラクター情報**
- **基本情報**: 名前、年齢、職業、役割
- **性格**: 外部・内部性格、特徴、長所・短所
- **好み**: 好き・嫌い、趣味
- **外見**: 外見の詳細
- **コミュニケーション**: 話し方、一人称・二人称、口癖
- **NSFWプロファイル**: ペルソナ、性欲レベル、状況、精神状態、嗜好
- **背景**: 背景ストーリー、現在のシナリオ

#### **ペルソナ情報**
- ユーザー名
- 役割
- その他の設定

#### **関係状態（トラッカー）**
- 好感度、信頼度、親密度
- 恋愛度、友情度
- 気分・機嫌
- その他の関係性指標

#### **メモリー文脈**
- ピン留めされたメモリーカード
- 関連するメモリーカード
- カテゴリ、タイトル、要約、キーワード

#### **会話履歴**
- 最近の会話メッセージ（設定値に基づく上限）
- セッション要約

### ⚡ **プログレッシブシステム**

1. **ベースプロンプト** (50-100ms) - 基本情報のみ
2. **拡張プロンプト** (バックグラウンド) - 履歴情報を追加

### 🔧 **技術的特徴**

- **変数置換**: `{{user}}`, `{{char}}` などのプレースホルダー
- **メモリー最適化**: ConversationManagerキャッシュ
- **パフォーマンス**: 増分更新、バッチ処理
- **エラーハンドリング**: フォールバック機能
- **デバッグ**: 開発環境での詳細ログ出力

### 📊 **設定による制御**

- メモリーカード上限
- 会話履歴上限
- システムプロンプト有効/無効
- Jailbreakプロンプト有効/無効

このシステムは、キャラクターの一貫性を保ちながら、ユーザーの文脈、関係性、過去の会話を全て考慮した包括的なプロンプトを生成しています。

---

