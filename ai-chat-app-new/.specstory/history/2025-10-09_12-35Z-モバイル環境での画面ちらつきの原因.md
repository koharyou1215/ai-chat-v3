<!-- Generated by SpecStory -->

<!-- cursor Session 3cbfb202-46dd-4fbd-b6b3-1c12e5b3ccbd (2025-10-09 12:35Z) -->

# モバイル環境での画面ちらつきの原因 (2025-10-09 12:35Z)

_**User (2025-10-09 12:35Z)**_

本番環境をモバイルでプレイしていると、画面のちらつきがサイドボタンを押したり、メニューを表示させたり、何かを更新するたびに画面のちらつきが入ってしまいます。この原因わかりますか?

---

_**Assistant (gpt-5-codex)**_

<think><details><summary>Thought Process</summary>**Investigating mobile flickering causes**</details></think>

---

Tool use: **list_dir**

<details>
            <summary>Listed directory undefined • **0** results</summary>
        
No results found
</details>

---

<think><details><summary>Thought Process</summary>**Analyzing mobile flicker causes**</details></think>

---

Tool use: **ripgrep**

---

<think><details><summary>Thought Process</summary>**Explaining mobile viewport flicker causes**

I’m preparing a clear explanation in Japanese about why mobile menus cause flicker, focusing on the use of 100vh in CSS causing viewport height recalculations when UI controls toggle. I'll mention the relevant code in `AppearanceProvider.tsx` and `globals.css` with citations and suggest using dynamic viewport units like `dvh` or JavaScript-based height variables to prevent layout reflows.</details></think>

---

### 推測される原因
- `height: 100vh` を使っているコンテナが多数あり、アドレスバーやメニュー表示で実効ビューポートが変動するたびに再レイアウトが発生し、モバイルでちらつきが生じている可能性が高いです  
```314:328:src/components/providers/AppearanceProvider.tsx
// ... existing code ...
height: 100vh;
// ... existing code ...
min-height: 100vh !important;
```
```350:358:src/app/globals.css
// ... existing code ...
height: 100vh !important;
min-height: 100vh !important;
```

### 対応案
- モバイルでは `100vh` の代わりに `100dvh` や `100svh` を試す、または `window.innerHeight` を CSS カスタムプロパティに入れて動的に更新する実装へ差し替えると、アドレスバー表示・非表示でのリサイズを吸収できます。
- 根本確認のため、対象要素を一時的に `height: auto` に変えて再現チェックし、ちらつきが収まるか検証すると原因切り分けが可能です。

### 次のステップ
- 該当コンテナの `100vh` 依存箇所を洗い出し（上記以外にもある場合）、優先して差し替え。
- 実機デバッグでスクロール・メニュー展開時のリサイズイベントの発生有無をロギングして挙動を再確認。

---

